<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CreativeScore AI - Analizzatore CRO & Comportamentale</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      body {
        font-family: 'Inter', sans-serif;
        background-color: #0f172a;
        color: #f8fafc;
        min-height: 100vh;
      }
      .glass-panel {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .animate-fade-in-up {
        animation: fadeInUp 0.5s ease-out;
      }
      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #475569;
      }
      .cursor-wait {
        cursor: wait;
      }
      @media print {
        header, .upload-section, .download-buttons {
          display: none !important;
        }
        body {
          background-color: white;
          color: black;
        }
        .glass-panel {
          background: white !important;
          border: 1px solid #e2e8f0;
          color: black;
        }
        #root {
          padding: 0 !important;
          margin: 0 !important;
        }
        main {
          margin-top: 0 !important;
        }
        .text-white, .text-slate-200, .text-slate-300 {
          color: black !important;
        }
        .text-slate-400, .text-slate-500 {
          color: #64748b !important;
        }
        .bg-slate-900, .bg-slate-800, .bg-slate-950 {
          background-color: #f8fafc !important;
        }
      }
    </style>

    <!-- Import Map per gestire le dipendenze React ed esterne direttamente nel browser -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
        "lucide-react": "https://esm.sh/lucide-react@0.460.0?external=react",
        "html2canvas": "https://esm.sh/html2canvas@1.4.1",
        "jspdf": "https://esm.sh/jspdf@2.5.1"
      }
    }
    </script>

    <!-- Babel Standalone per compilare JSX nel browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="typescript,react">
      import React, { useState, useCallback, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import {
        Upload, ScanEye, Sparkles, AlertCircle, Loader2, ArrowRight,
        CheckCircle2, AlertTriangle, Lightbulb, Brain, Activity, MessageSquareQuote, Zap, Search, ArrowRightCircle,
        Download, FileText, Image as ImageIcon, FileDown, ShieldCheck, Target, Lock, MousePointer2, Layout, Users,
        TrendingUp, Layers, Repeat, List
      } from 'lucide-react';
      import html2canvas from 'html2canvas';
      import { jsPDF } from 'jspdf';

      // --- CONFIGURAZIONE ---
      const USE_MOCK = true;
      const HARDCODED_API_KEY = "";

      const AnalysisStatus = {
        IDLE: 'IDLE',
        ANALYZING: 'ANALYZING',
        COMPLETE: 'COMPLETE',
        ERROR: 'ERROR'
      };

      // Mock Data Generator
      const getMockAnalysis = async () => {
        await new Promise(r => setTimeout(r, 4000));
        return {
          heatmap: [
            { x: 50, y: 20, intensity: 0.9 },
            { x: 20, y: 45, intensity: 0.6 },
            { x: 80, y: 45, intensity: 0.7 },
            { x: 50, y: 75, intensity: 0.8 },
            { x: 30, y: 30, intensity: 0.5 },
          ],
          report: {
            headline: {
              score: 65,
              evaluation: "La headline descrive il servizio ma non esprime un beneficio economico o di business immediato.",
              alternatives: [
                "Ottieni +30% di Lead qualificati in 30 giorni senza aumentare il budget advertising",
                "Riduci il costo di acquisizione cliente del 25% grazie alla nostra automazione AI",
                "Trasforma i visitatori in clienti: la strategia CRO che ha generato 1.2M€ per i nostri partner"
              ]
            },
            benefits: {
              score: 55,
              vaguePoints: [
                "Uso di 'più visibilità' invece di traffico targetizzato",
                "Mancanza di scenari prima/dopo per l'implementazione del software",
                "Descrizioni tecniche prive di outcome misurabili"
              ],
              rewrites: [
                { from: "Più velocità per il tuo sito", to: "Caricamento in meno di 1.2 secondi per ridurre l'abbandono del carrello del 15%" },
                { from: "Supporto dedicato 24/7", to: "Un esperto risponde alle tue emergenze in meno di 10 minuti, garantendo continuità di business" }
              ]
            },
            levers: [
              { name: "Prova sociale", status: "debole", observation: "Presenti solo loghi, mancano testimonianze con risultati numerici.", improvement: "Inserire almeno 3 citazioni di clienti che menzionano il ROI ottenuto." },
              { name: "Autorità", status: "assente", observation: "Nessuna certificazione o dato di mercato citato.", improvement: "Aggiungere badge di certificazione settore o numero di aziende gestite." },
              { name: "Scarsità/Urgenza", status: "assente", observation: "L'offerta non ha limiti temporali.", improvement: "Inserire un bonus esclusivo per le prime 10 consulenze del mese." },
              { name: "Reciprocità", status: "forte", observation: "Ottimo ebook gratuito offerto in cambio della mail.", improvement: "Posizionarlo più in alto per aumentare il tasso di opt-in." },
              { name: "Loss Aversion", status: "assente", observation: "Non viene spiegato cosa perde il cliente non agendo ora.", improvement: "Sottolineare il costo dello spreco di budget con l'attuale setup inefficiente." },
              { name: "Commitment", status: "debole", observation: "Il primo step richiesto è troppo impegnativo (form lungo).", improvement: "Chiedere solo l'URL del sito come primo micro-impegno." },
            ],
            impactAnalysis: [
              { area: "Headline & Promessa", impact: "Alto", boost: "+15-25%", details: "Riscrivere la headline per focus sul beneficio economico immediato." },
              { area: "Chiarezza Form & CTA", impact: "Alto", boost: "+10-20%", details: "Migliorare il contrasto visivo e ridurre i campi richiesti nel form." },
              { area: "Prove Sociali Numeriche", impact: "Medio", boost: "+8-12%", details: "Sostituire i loghi semplici con citazioni orientate al ROI." },
              { area: "Urgenza & Scarsità", impact: "Medio", boost: "+5-10%", details: "Inserire un trigger temporale reale vicino al punto di conversione." },
              { area: "Fiducia Visuale (Icone/Badge)", impact: "Basso", boost: "+2-5%", details: "Aggiungere rassicurazioni grafiche sulla privacy e sicurezza." }
            ],
            combinedPackages: [
              { title: "Power Hook (Headline + Social Proof)", reasoning: "La combinazione di una promessa forte supportata immediatamente da dati numerici di altri clienti abbatte lo scetticismo iniziale." },
              { title: "Safe Conversion (Urgenza + Risk Reduction)", reasoning: "L'urgenza spinge all'azione, ma solo se accompagnata da rassicurazioni che eliminano la paura di sbagliare acquisto." },
              { title: "Low Friction Entry (Micro-Commitment + Form Clarity)", reasoning: "Chiedere un dato semplice prima del form completo aumenta il tasso di inizio completamento del 40%." }
            ],
            foldAnalysis: {
              score: 45,
              elements: { headline: "Presente ma debole", proof: "Mancante", cta: "Poco visibile" },
              suggestions: [
                "Spostare i loghi dei clienti nella prima schermata (sotto la headline).",
                "Aumentare la dimensione del font della Headline del 20%.",
                "Assicurarsi che il bottone CTA sia visibile senza scrollare su mobile."
              ]
            },
            formFriction: {
              level: "Alto",
              score: 35,
              fields: 7,
              evaluation: "Il form richiede troppi dati personali non necessari alla prima fase di contatto, scoraggiando gli utenti.",
              suggestions: [
                "Ridurre i campi da 7 a 4 (Nome, Email, Azienda, Messaggio).",
                "Aggiungere microcopy: 'Rispondiamo in meno di 24 ore'.",
                "Inserire check di privacy pre-selezionato o rassicurazione visibile."
              ]
            },
            pathConsistency: {
              issues: "La headline promette 'Risparmio', ma le testimonianze parlano di 'Qualità' e la CTA dice 'Invia Messaggio'.",
              proposal: "Allineare tutto sul concetto di 'Efficienza': Headline (Risparmia tempo), Case Study (Come abbiamo ridotto i tempi), CTA (Inizia a risparmiare)."
            },
            persuasiveSequence: {
              current: ["Soluzione", "Chi Siamo", "Funzionalità", "Contatti"],
              recommended: ["Problema (Costo inazione)", "Promessa (Headline)", "Soluzione (Come funziona)", "Prove (Case Studies)", "Riduzione Rischio", "CTA Finale"],
              suggestions: "Spostare la sezione 'Costi dell'Inazione' subito dopo la Headline per creare tensione emotiva prima della soluzione."
            },
            topPriorityCombinations: {
              singles: [
                { action: "Headline orientata all'outcome", impact: "Alto", why: "Crea chiarezza immediata sul valore." },
                { action: "Semplificazione campi form", impact: "Alto", why: "Abbassa drasticamente la barriera all'ingresso." },
                { action: "Testimonianze con dati numerici", impact: "Medio", why: "Fornisce la prova razionale del beneficio." },
                { action: "CTA con contrasto elevato", impact: "Medio", why: "Guida l'occhio verso l'azione desiderata." },
                { action: "Aggiunta trigger di urgenza", impact: "Medio", why: "Combatte la procrastinazione dell'utente." }
              ],
              combos: [
                { action: "Headline + Prova Sociale nel Fold", impact: "Massimo", why: "Massimizza la fiducia nei primi 3 secondi." },
                { action: "Urgenza + Rassicurazione Privacy", impact: "Elevato", why: "Spinge all'azione riducendo l'ansia da spam." },
                { action: "Micro-impegno + Form ridotto", impact: "Elevato", why: "Aumenta la completion rate del percorso." }
              ]
            },
            summary: {
              scores: {
                "Promessa": 65,
                "Benefici": 55,
                "Persuasione": 35,
                "Testimonianze": 30,
                "Target/Locale": 40,
                "Leggibilità": 75,
                "Coerenza": 50,
                "Fiducia": 45
              },
              judgment: "La pagina informa ma non rassicura. Il percorso verso la conversione è interrotto da mancanze di dati concreti e microcopy poco curato vicino ai punti decisionali.",
              overall: 47
            },
            strategic: {
              positioning: {
                score: 55,
                description: "Il posizionamento attuale è troppo generico ('software per aziende'). Manca una specializzazione chiara che risuoni con un segmento specifico.",
                improvedFormula: "L'unica piattaforma AI che riduce il churn del 20% per SaaS B2B automatizzando il customer success."
              },
              resultMechanism: {
                score: 40,
                steps: [
                  { step: "Integrazione Dati", benefit: "Zero inserimento manuale, tutto si sincronizza in 5 minuti." },
                  { step: "Analisi Predittiva", benefit: "Identifica i clienti a rischio prima che decidano di disdire." },
                  { step: "Azione Automatica", benefit: "Invia l'offerta giusta al momento giusto senza intervento umano." }
                ]
              },
              transformation: {
                score: 50,
                before: "Stress costante, perdita di fatturato imprevedibile, team sommerso da ticket di cancellazione.",
                after: "Crescita lineare, controllo totale sui ricavi ricorrenti, team focalizzato su espansione e non su emergenze."
              },
              objections: [
                { objection: "È troppo difficile da configurare", counter: "Setup assistito in 24 ore e integrazioni native 1-click." },
                { objection: "Costa troppo per il mio volume", counter: "Piano 'Pay as you Grow' che si ripaga da solo col primo cliente salvato." },
                { objection: "Abbiamo già un tool simile", counter: "La nostra IA è l'unica focalizzata sul Churn, non è un CRM generico." }
              ],
              differentiation: {
                score: 35,
                uniqueElements: ["Algoritmo proprietario Churn-Predict", "Setup assistito incluso", "Garanzia 'Soddisfatti o Salvati'"]
              },
              motivation: {
                score: 60,
                suggestions: [
                  "Usa verbi di potere legati al possesso e al controllo.",
                  "Enfatizza il 'tempo recuperato' come valuta principale.",
                  "Collega ogni funzionalità a un'emozione di sollievo o orgoglio professionale."
                ]
              },
              narrativeCoherence: {
                score: 45,
                issues: "La storia si interrompe tra la promessa e la prova tecnica.",
                recommendedStoryline: [
                  "Lo scenario del fallimento (perché i metodi vecchi non funzionano più)",
                  "La scoperta della nuova via (il nostro approccio)",
                  "La prova del successo (il cliente che ce l'ha fatta)",
                  "L'invito alla trasformazione"
                ]
              },
              leversMap: {
                ranking: ["Autorità", "Riprova Sociale", "Simpatia", "Scarsità"],
                toStrengthen: ["Coerenza", "Reciprocità"]
              },
              rewritingRules: [
                "Elimina gli aggettivi deboli (es. 'ottimo', 'veloce') e usa numeri.",
                "Parla al 'Tu' e non al 'Noi'.",
                "Metti il beneficio prima della caratteristica."
              ]
            }
          }
        };
      };

      const analyzeImage = async (base64Image) => {
        if (USE_MOCK) return getMockAnalysis();
        return getMockAnalysis();
      };

      // --- COMPONENTS ---

      const HeatmapOverlay = ({ imageSrc, points }) => {
        return (
          <div className="relative w-full overflow-hidden rounded-lg shadow-2xl group border border-slate-700 bg-slate-900">
            <img src={imageSrc} alt="Analyzed Content" className="w-full h-auto block object-contain" />
            <div className="absolute inset-0 mix-blend-screen pointer-events-none">
              {points && points.map((point, index) => (
                <div key={index} className="absolute rounded-full blur-xl"
                  style={{
                    left: `${point.x}%`, top: `${point.y}%`,
                    width: `${100 * point.intensity}px`, height: `${100 * point.intensity}px`,
                    transform: 'translate(-50%, -50%)',
                    background: `radial-gradient(circle, rgba(255, 0, 0, 0.8) 0%, rgba(255, 165, 0, 0.5) 40%, rgba(0, 0, 255, 0) 70%)`,
                    opacity: point.intensity * 0.8,
                  }}
                />
              ))}
            </div>
          </div>
        );
      };

      const ScoreCard = ({ title, score, color = "text-blue-500", description }) => {
        const radius = 36;
        const circumference = 2 * Math.PI * radius;
        const offset = circumference - (score / 100) * circumference;
        let strokeColor = score >= 80 ? "stroke-emerald-500" : score >= 50 ? "stroke-yellow-500" : "stroke-red-500";

        return (
          <div className="glass-panel p-6 rounded-xl flex flex-col items-center justify-center text-center relative overflow-hidden group hover:bg-slate-800/80 transition-all duration-300">
            <div className="relative w-32 h-32 mb-4">
              <svg className="w-full h-full transform -rotate-90">
                <circle cx="64" cy="64" r={radius} className="stroke-slate-700" strokeWidth="8" fill="none" />
                <circle cx="64" cy="64" r={radius} className={`transition-all duration-1000 ease-out ${strokeColor}`} strokeWidth="8" strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" fill="none" />
              </svg>
              <div className="absolute inset-0 flex items-center justify-center flex-col">
                <span className="text-3xl font-bold text-white">{score}</span>
                <span className="text-xs text-slate-400">/ 100</span>
              </div>
            </div>
            <h3 className="text-lg font-semibold text-slate-200">{title}</h3>
          </div>
        );
      };

      const ReportSection = ({ data }) => {
        const { report } = data;
        return (
          <div className="space-y-24">
            {/* 1. IMPATTO E POTENZIALE */}
            <section className="animate-fade-in-up">
              <div className="flex items-center gap-4 mb-8">
                <TrendingUp className="text-indigo-400 w-8 h-8" />
                <h2 className="text-3xl font-black text-white uppercase tracking-tight">Stima Impatto sulla Conversione</h2>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {report.impactAnalysis.map((item, i) => (
                  <div key={i} className="glass-panel p-6 rounded-2xl border-t-4 border-indigo-500 hover:scale-[1.02] transition-transform">
                    <div className="flex justify-between items-start mb-4">
                      <h3 className="font-bold text-white">{item.area}</h3>
                      <span className={`px-2 py-1 rounded text-[10px] font-black uppercase ${
                        item.impact === 'Alto' ? 'bg-red-500/20 text-red-400' : 'bg-amber-500/20 text-amber-400'
                      }`}>Impatto {item.impact}</span>
                    </div>
                    <div className="text-3xl font-black text-indigo-400 mb-2">{item.boost}</div>
                    <p className="text-slate-400 text-sm">{item.details}</p>
                  </div>
                ))}
              </div>
            </section>

            {/* 2. ABOVE THE FOLD */}
            <section className="glass-panel p-10 rounded-[40px] border-l-8 border-cyan-500">
               <div className="flex justify-between items-start mb-10">
                 <div>
                   <h2 className="text-3xl font-black text-white uppercase flex items-center gap-3"><Layout className="text-cyan-400" /> Efficacia Above the Fold</h2>
                   <p className="text-slate-400 mt-2">Valutazione dei primi secondi di impatto visivo.</p>
                 </div>
                 <div className="text-center">
                    <div className="text-5xl font-black text-cyan-400">{report.foldAnalysis.score}</div>
                    <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Punteggio Fold</div>
                 </div>
               </div>
               <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                  {Object.entries(report.foldAnalysis.elements).map(([k, v], i) => (
                    <div key={i} className="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                      <div className="text-xs font-bold text-slate-500 uppercase mb-2 tracking-widest">{k}</div>
                      <div className="text-white font-bold">{v}</div>
                    </div>
                  ))}
               </div>
               <div className="space-y-4">
                 <h3 className="text-sm font-bold text-cyan-400 uppercase tracking-widest">Interventi Immediati (Senza Scroll):</h3>
                 <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                   {report.foldAnalysis.suggestions.map((s, i) => (
                     <div key={i} className="flex gap-3 items-start text-slate-300 text-sm bg-cyan-500/5 p-4 rounded-xl border border-cyan-500/10">
                       <ArrowRight size={16} className="text-cyan-500 shrink-0 mt-0.5" /> {s}
                     </div>
                   ))}
                 </div>
               </div>
            </section>

            {/* 3. ATTRITO DEL FORM */}
            <section className="grid grid-cols-1 lg:grid-cols-12 gap-8">
               <div className="lg:col-span-4 flex flex-col gap-6">
                 <div className="glass-panel p-8 rounded-3xl text-center border-b-8 border-red-500">
                   <div className="bg-red-500/10 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4">
                     <MousePointer2 className="text-red-500 w-8 h-8" />
                   </div>
                   <h2 className="text-xl font-black text-white uppercase tracking-tight">Attrito del Form</h2>
                   <div className="text-5xl font-black text-red-500 my-4">{report.formFriction.score}</div>
                   <div className={`text-xs font-black uppercase px-4 py-1 rounded-full inline-block ${
                     report.formFriction.level === 'Alto' ? 'bg-red-500/20 text-red-400' : 'bg-amber-500/20 text-amber-400'
                   }`}>Livello Attrito: {report.formFriction.level}</div>
                 </div>
               </div>
               <div className="lg:col-span-8 glass-panel p-8 rounded-3xl flex flex-col justify-center">
                  <p className="text-slate-300 text-lg italic mb-8">"{report.formFriction.evaluation}"</p>
                  <div className="space-y-4">
                    <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest">Strategie di Riduzione Attrito:</h3>
                    {report.formFriction.suggestions.map((s, i) => (
                      <div key={i} className="flex gap-3 items-center text-white bg-slate-800/50 p-4 rounded-2xl border border-slate-700">
                        <CheckCircle2 className="text-emerald-500" size={20} /> {s}
                      </div>
                    ))}
                  </div>
               </div>
            </section>

            {/* 4. SEQUENZA E COERENZA */}
            <section className="space-y-12">
               <div className="flex items-center gap-4 border-b border-slate-800 pb-6">
                 <Repeat className="text-amber-400 w-8 h-8" />
                 <h2 className="text-3xl font-black text-white uppercase tracking-tight">Percorso e Coerenza</h2>
               </div>

               <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  <div className="glass-panel p-8 rounded-3xl">
                     <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><List className="text-amber-400" /> Analisi Coerenza Percorso</h3>
                     <p className="text-slate-300 mb-6 bg-red-500/5 p-4 rounded-xl border border-red-500/10 italic">"{report.pathConsistency.issues}"</p>
                     <div className="bg-emerald-500/5 p-6 rounded-2xl border border-emerald-500/20">
                        <h4 className="text-xs font-bold text-emerald-500 uppercase mb-3 tracking-widest">Proposta di Allineamento Testuale:</h4>
                        <p className="text-white font-medium">{report.pathConsistency.proposal}</p>
                     </div>
                  </div>

                  <div className="glass-panel p-8 rounded-3xl">
                     <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><Target className="text-purple-400" /> Sequenza Persuasiva Ottimale</h3>
                     <div className="flex flex-col gap-4">
                        <div className="flex items-center gap-4">
                           <span className="text-[10px] font-bold text-slate-500 w-20 shrink-0 uppercase tracking-tighter">Attuale:</span>
                           <div className="flex gap-2 overflow-hidden overflow-x-auto pb-2 scrollbar-hide">
                              {report.persuasiveSequence.current.map((s, i) => (
                                <span key={i} className="text-[10px] bg-slate-800 text-slate-500 px-3 py-1 rounded-full whitespace-nowrap">{s}</span>
                              ))}
                           </div>
                        </div>
                        <div className="flex items-center gap-4">
                           <span className="text-[10px] font-bold text-purple-400 w-20 shrink-0 uppercase tracking-tighter">Consigliata:</span>
                           <div className="flex gap-2 overflow-hidden overflow-x-auto pb-2 scrollbar-hide">
                              {report.persuasiveSequence.recommended.map((s, i) => (
                                <span key={i} className="text-[10px] bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full whitespace-nowrap font-bold">{s}</span>
                              ))}
                           </div>
                        </div>
                        <p className="mt-4 text-slate-400 text-sm italic">{report.persuasiveSequence.suggestions}</p>
                     </div>
                  </div>
               </div>
            </section>

            {/* 5. PACCHETTI COMBINATI */}
            <section>
              <h2 className="text-2xl font-black text-white mb-8 uppercase tracking-tighter flex items-center gap-3"><Layers className="text-indigo-400" /> Pacchetti di Intervento Combinati</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                 {report.combinedPackages.map((pkg, i) => (
                   <div key={i} className="glass-panel p-8 rounded-[32px] bg-gradient-to-br from-indigo-600/10 to-transparent border border-indigo-500/20">
                      <h3 className="text-indigo-400 font-black mb-4 uppercase tracking-tight">{pkg.title}</h3>
                      <p className="text-slate-300 text-sm leading-relaxed">{pkg.reasoning}</p>
                   </div>
                 ))}
              </div>
            </section>

            {/* 6. TOP PRIORITÀ FINALI */}
            <section className="grid grid-cols-1 lg:grid-cols-2 gap-8">
               <div className="glass-panel p-10 rounded-[40px] bg-slate-950 border-2 border-indigo-500/30">
                  <h2 className="text-2xl font-black text-white mb-8 uppercase tracking-tighter">Top 5 Interventi Singoli</h2>
                  <div className="space-y-6">
                    {report.topPriorityCombinations.singles.map((p, i) => (
                      <div key={i} className="flex gap-4 items-start group">
                        <div className="w-10 h-10 rounded-xl bg-indigo-600 flex items-center justify-center text-lg font-black text-white shrink-0 shadow-lg shadow-indigo-500/40 group-hover:scale-110 transition-transform">{i + 1}</div>
                        <div>
                          <p className="text-white text-base font-bold leading-tight">{p.action}</p>
                          <p className="text-[10px] text-slate-500 uppercase font-black mt-1">Impatto {p.impact} • {p.why}</p>
                        </div>
                      </div>
                    ))}
                  </div>
               </div>
               <div className="glass-panel p-10 rounded-[40px] bg-slate-950 border-2 border-emerald-500/30">
                  <h2 className="text-2xl font-black text-white mb-8 uppercase tracking-tighter">Top 3 Combinazioni Strategiche</h2>
                  <div className="space-y-6">
                    {report.topPriorityCombinations.combos.map((p, i) => (
                      <div key={i} className="flex gap-4 items-start group">
                        <div className="w-10 h-10 rounded-xl bg-emerald-600 flex items-center justify-center text-lg font-black text-white shrink-0 shadow-lg shadow-emerald-500/40 group-hover:scale-110 transition-transform">{String.fromCharCode(65 + i)}</div>
                        <div>
                          <p className="text-white text-base font-bold leading-tight">{p.action}</p>
                          <p className="text-[10px] text-emerald-500 uppercase font-black mt-1">Impatto {p.impact} • {p.why}</p>
                        </div>
                      </div>
                    ))}
                  </div>
               </div>
            </section>

            {/* 7. ANALISI STRATEGICA PROFONDA */}
            <section className="space-y-16">
               <div className="flex items-center gap-4 border-b border-slate-800 pb-6">
                 <Brain className="text-pink-400 w-8 h-8" />
                 <h2 className="text-3xl font-black text-white uppercase tracking-tight">Analisi Strategica Profonda</h2>
               </div>

               {/* Posizionamento & Differenziazione */}
               <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  <div className="glass-panel p-8 rounded-3xl border-l-4 border-pink-500">
                    <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><Target className="text-pink-400" /> Posizionamento</h3>
                    <p className="text-slate-300 mb-6">{report.strategic.positioning.description}</p>
                    <div className="bg-pink-500/10 p-6 rounded-2xl border border-pink-500/20">
                      <h4 className="text-[10px] font-bold text-pink-400 uppercase mb-2 tracking-widest font-black">Formula di Posizionamento Suggerita:</h4>
                      <p className="text-white text-lg font-bold italic leading-tight">"{report.strategic.positioning.improvedFormula}"</p>
                    </div>
                  </div>
                  <div className="glass-panel p-8 rounded-3xl border-l-4 border-indigo-500">
                    <h3 className="text-xl font-bold text-white mb-4 flex items-center gap-2"><ShieldCheck className="text-indigo-400" /> Elementi Differenzianti</h3>
                    <div className="space-y-3">
                      {report.strategic.differentiation.uniqueElements.map((el, i) => (
                        <div key={i} className="flex items-center gap-3 bg-slate-800/50 p-3 rounded-xl border border-slate-700">
                          <Zap size={16} className="text-yellow-400" />
                          <span className="text-slate-200 font-medium">{el}</span>
                        </div>
                      ))}
                    </div>
                  </div>
               </div>

               {/* Meccanismo & Trasformazione */}
               <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                  <div className="lg:col-span-7 glass-panel p-8 rounded-3xl">
                    <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><Activity className="text-emerald-400" /> Meccanismo del Risultato</h3>
                    <div className="relative space-y-8 before:absolute before:left-[19px] before:top-2 before:bottom-2 before:w-0.5 before:bg-slate-700">
                      {report.strategic.resultMechanism.steps.map((step, i) => (
                        <div key={i} className="relative flex gap-6 items-start">
                          <div className="w-10 h-10 rounded-full bg-slate-800 border-4 border-slate-900 flex items-center justify-center text-emerald-400 font-black z-10">{i+1}</div>
                          <div>
                            <h4 className="text-white font-bold">{step.step}</h4>
                            <p className="text-slate-400 text-sm">{step.benefit}</p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  <div className="lg:col-span-5 glass-panel p-8 rounded-3xl bg-gradient-to-br from-indigo-900/20 to-transparent">
                    <h3 className="text-xl font-bold text-white mb-6 flex items-center gap-2"><ArrowRightCircle className="text-indigo-400" /> Narrativa di Trasformazione</h3>
                    <div className="space-y-6">
                      <div className="p-4 rounded-2xl bg-red-500/5 border border-red-500/10">
                        <div className="text-[10px] font-bold text-red-400 uppercase mb-1">Stato Attuale (Dolore)</div>
                        <p className="text-slate-300 text-sm italic">{report.strategic.transformation.before}</p>
                      </div>
                      <div className="flex justify-center"><ArrowRight className="text-slate-700 rotate-90 lg:rotate-0" /></div>
                      <div className="p-4 rounded-2xl bg-emerald-500/5 border border-emerald-500/10">
                        <div className="text-[10px] font-bold text-emerald-400 uppercase mb-1">Stato Futuro (Piacere)</div>
                        <p className="text-white text-sm font-bold italic">{report.strategic.transformation.after}</p>
                      </div>
                    </div>
                  </div>
               </div>

               {/* Obiezioni & Copywriting */}
               <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                  <div className="lg:col-span-2 glass-panel p-8 rounded-3xl">
                    <h3 className="text-xl font-bold text-white mb-6">Gestione Obiezioni & Credibilità</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {report.strategic.objections.map((obj, i) => (
                        <div key={i} className="p-5 rounded-2xl bg-slate-900/50 border border-slate-700 hover:border-indigo-500/30 transition-colors">
                           <div className="flex items-start gap-2 mb-2 text-slate-400">
                             <MessageSquareQuote size={16} className="shrink-0 mt-1" />
                             <span className="text-xs font-bold italic">"{obj.objection}"</span>
                           </div>
                           <div className="flex items-start gap-2 text-white">
                             <CheckCircle2 size={16} className="text-emerald-500 shrink-0 mt-1" />
                             <span className="text-sm font-medium">{obj.counter}</span>
                           </div>
                        </div>
                      ))}
                    </div>
                  </div>
                  <div className="glass-panel p-8 rounded-3xl">
                    <h3 className="text-xl font-bold text-white mb-6">Copywriting Rules</h3>
                    <ul className="space-y-4">
                      {report.strategic.rewritingRules.map((rule, i) => (
                        <li key={i} className="flex gap-3 text-slate-300 text-sm">
                          <div className="w-1.5 h-1.5 rounded-full bg-pink-500 mt-2 shrink-0" />
                          {rule}
                        </li>
                      ))}
                    </ul>
                  </div>
               </div>
            </section>
          </div>
        );
      };

      const App = () => {
        const [status, setStatus] = useState(AnalysisStatus.IDLE);
        const [imagePreview, setImagePreview] = useState(null);
        const [result, setResult] = useState(null);
        const [errorMsg, setErrorMsg] = useState("");
        const [isDownloading, setIsDownloading] = useState(false);
        const reportRef = useRef(null);

        const handleFileChange = useCallback(async (event) => {
          const file = event.target.files?.[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onloadend = () => { setImagePreview(reader.result); setResult(null); setErrorMsg(""); };
          reader.readAsDataURL(file);
        }, []);

        const downloadReport = async (format) => {
          if (!reportRef.current) return;
          setIsDownloading(true);
          try {
            if (format === 'docx') {
              const sourceHTML = "<html><head><meta charset='utf-8'></head><body>" + reportRef.current.innerHTML + "</body></html>";
              const blob = new Blob(['\ufeff', sourceHTML], { type: 'application/msword' });
              const link = document.createElement("a");
              link.href = URL.createObjectURL(blob); link.download = `CreativeScore-Analysis-${Date.now()}.doc`; link.click();
            } else {
              const canvas = await html2canvas(reportRef.current, { scale: 2, useCORS: true, backgroundColor: '#0f172a' });
              if (format === 'pdf') {
                const pdf = new jsPDF({ orientation: 'portrait', unit: 'px', format: [canvas.width / 2, canvas.height / 2] });
                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, canvas.width / 2, canvas.height / 2);
                pdf.save(`CreativeScore-Analysis-${Date.now()}.pdf`);
              } else {
                const link = document.createElement('a'); link.download = `CreativeScore-Analysis-${Date.now()}.${format}`;
                link.href = canvas.toDataURL(`image/${format}`, 1.0); link.click();
              }
            }
          } catch (err) { alert("Errore durante il download."); } finally { setIsDownloading(false); }
        };

        const handleAnalyze = async () => {
          setStatus(AnalysisStatus.ANALYZING);
          try { setResult(await analyzeImage()); setStatus(AnalysisStatus.COMPLETE); }
          catch (err) { setErrorMsg("Errore imprevisto."); setStatus(AnalysisStatus.ERROR); }
        };

        return (
          <div className="min-h-screen pb-20">
            <header className="border-b border-white/10 bg-[#0f172a]/80 backdrop-blur-md sticky top-0 z-50">
              <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <div className="bg-indigo-600 p-2 rounded-lg"><ScanEye className="w-6 h-6 text-white" /></div>
                  <h1 className="text-xl font-bold bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">CreativeScore AI</h1>
                </div>
              </div>
            </header>

            <main className="max-w-7xl mx-auto px-4 mt-10">
              <div className="text-center mb-12">
                 <h2 className="text-4xl md:text-5xl font-bold text-white mb-6">Ottimizza la Conversione con <br /><span className="text-indigo-400">Analisi AI Predittiva</span></h2>
                 <div className="w-full max-w-xl mx-auto upload-section">
                   <label className={`flex flex-col items-center justify-center w-full rounded-2xl cursor-pointer transition-all ${imagePreview ? 'border-2 border-indigo-500 bg-indigo-900/20 p-4' : 'h-64 border-2 border-dashed border-slate-700 hover:border-indigo-400 hover:bg-slate-800'}`}>
                      {imagePreview ? <img src={imagePreview} className="max-h-[300px] rounded-lg shadow-2xl mb-4" /> : <div className="text-slate-400 flex flex-col items-center"><Upload className="w-12 h-12 mb-4" /><p>Carica screenshot Landing Page</p></div>}
                      <input type="file" className="hidden" onChange={handleFileChange} accept="image/*" />
                   </label>
                   {imagePreview && status !== AnalysisStatus.ANALYZING && !result && (
                     <button onClick={handleAnalyze} className="mt-6 w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-semibold transition-all flex items-center justify-center gap-2"><Sparkles className="w-5 h-5" />Analizza Landing Page</button>
                   )}
                   {status === AnalysisStatus.ANALYZING && <div className="mt-6 w-full py-4 bg-slate-800 text-slate-300 rounded-xl flex items-center justify-center gap-3"><Loader2 className="w-5 h-5 animate-spin text-indigo-400" />Generazione Report Avanzato...</div>}
                 </div>
              </div>

              {status === AnalysisStatus.COMPLETE && result && (
                <div className="animate-fade-in-up space-y-16">
                  <div className="border-t border-slate-800 pt-12 flex flex-col md:flex-row items-center justify-between gap-6">
                     <h2 className="text-3xl font-bold text-white uppercase tracking-tighter">Analisi Strategica Completa</h2>
                     <div className="flex flex-wrap gap-3 download-buttons">
                        {['pdf', 'png', 'jpeg', 'docx'].map(fmt => (
                          <button key={fmt} onClick={() => downloadReport(fmt)} disabled={isDownloading} className="bg-slate-800 hover:bg-slate-700 text-slate-200 px-4 py-2 rounded-lg border border-slate-700 text-xs font-bold uppercase disabled:opacity-50">{fmt}</button>
                        ))}
                     </div>
                  </div>

                  <div ref={reportRef} className="space-y-24 p-8 bg-slate-900 rounded-[48px] border border-white/5">
                    <div className="text-center">
                       <h2 className="text-4xl font-black text-white uppercase tracking-tighter">Audit Avanzato CRO & Persuasione</h2>
                       <div className="w-32 h-2 bg-indigo-500 mx-auto mt-6 rounded-full"></div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-12">
                      <div className="lg:col-span-7 space-y-6">
                         <h3 className="text-2xl font-bold text-slate-200 flex items-center gap-3 uppercase tracking-tighter"><ScanEye className="text-indigo-400" /> Mappa Attentiva Predittiva</h3>
                         <HeatmapOverlay imageSrc={imagePreview} points={result.heatmap} />
                      </div>
                      <div className="lg:col-span-5 grid grid-cols-2 gap-4">
                        <div className="col-span-2"><ScoreCard title="Conversion Score Globale" score={result.report.summary.overall} /></div>
                        {["Promessa", "Benefici", "Persuasione", "Fiducia"].map(s => <ScoreCard key={s} title={s} score={result.report.summary.scores[s]} />)}
                      </div>
                    </div>
                    <ReportSection data={result} />
                  </div>
                </div>
              )}
            </main>
          </div>
        );
      };

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
